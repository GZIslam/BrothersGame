var F=Object.defineProperty;var M=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var v=(e,n,t)=>n in e?F(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,m=(e,n)=>{for(var t in n||(n={}))I.call(n,t)&&v(e,t,n[t]);if(M)for(var t of M(n))T.call(n,t)&&v(e,t,n[t]);return e};const W=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}};W();const d={w:0,h:0},x={player:"green",enemy:"red",shootingEnemy:"purple"},B=e=>{window.document.addEventListener("keydown",n=>{switch(n.code){case"KeyA":e.speed.x=-e.speed.common;break;case"KeyD":e.speed.x=e.speed.common;break;case"KeyW":e.speed.y=-e.speed.common;break;case"KeyS":e.speed.y=e.speed.common;break}}),window.document.addEventListener("keyup",n=>{switch(n.code){case"KeyA":e.speed.x<0&&(e.speed.x=0);break;case"KeyD":e.speed.x>0&&(e.speed.x=0);break;case"KeyW":e.speed.y<0&&(e.speed.y=0);break;case"KeyS":e.speed.y>0&&(e.speed.y=0);break}}),window.document.addEventListener("mousedown",n=>{e.shoot({x:n.clientX,y:n.clientY})})},w=document.getElementById("canvas"),r=w.getContext("2d"),z=()=>{d.w=w.width=window.innerWidth,d.h=w.height=window.innerHeight},g=({color:e,size:n,position:t})=>{r.beginPath(),r.fillStyle=e,r.arc(t.x,t.y,n,0,2*Math.PI),r.fill()},N=({color:e,width:n,position:t,size:i,value:s})=>{r.beginPath(),r.strokeStyle=e,r.lineWidth=n,r.arc(t.x,t.y,i,0,s*2*Math.PI),r.stroke()},k=({color:e,width:n,height:t,position:i})=>{r.beginPath(),r.fillStyle=e,r.rect(i.x,i.y,n,t),r.fill()},R=({text:e,position:n,size:t,color:i})=>{r.fillStyle=i,r.font=`${t}px serif`,r.fillText(e,n.x,n.y)},$=()=>{r.clearRect(0,0,window.innerWidth,window.innerHeight)};window.document.addEventListener("resize",z);z();const c=(e=0,n=0)=>({x:typeof e=="number"?e:e.x,y:typeof e=="number"?n:e.y,add:function(t){return c(this.x+t.x,this.y+t.y)},sub:function(t){return c(this.x-t.x,this.y-t.y)},mul:function(t){return c(this.x*t,this.y*t)},length:function(){return Math.hypot(Math.abs(this.x),Math.abs(this.y))},distanceTo:function(t){return c(t).sub(this).length()},setLength:function(t){const i=this.length();return c(this.x*t/i,this.y*t/i)},perpendicular:function(){return c(-this.y,this.x)}}),q=({color:e,damage:n,size:t,speed:i,owner:s,position:o})=>({color:e,damage:n,size:t,speed:i,owner:s,position:o,disabled:!1,draw:()=>g({color:e,size:t,position:o}),animate:function(){o.x+=i.x,o.y+=i.y,(o.x<0||o.x>d.w||o.y<0||o.y>d.h)&&(this.disabled=!0,console.log("disabled"))}}),S=(e,n)=>c(e.position).sub(n.position).length()<=e.size+n.size,h={players:[],bullets:[],draw:function(){$(),this.players.forEach(e=>e.draw()),this.bullets.forEach(e=>e.draw())},animate:function(){this.players.forEach(e=>e.animate()),this.bullets.forEach(e=>e.animate()),this.checkCollisions(),this.removeOrphans()},removeOrphans:function(){this.players=this.players.filter(e=>!e.disabled),this.bullets=this.bullets.filter(e=>!e.disabled)},checkCollisions:function(){this.players.forEach(e=>{this.bullets.forEach(n=>{S(e,n)&&n.owner.type!==e.type&&(e.getDamage(n.damage)&&n.owner.score++,n.disabled=!0)}),this.players.forEach(n=>{S(e,n)&&n.type!==e.type&&n.hit(e)})})},isLevelFinished:function(){return this.players.every(e=>e.type==="player")}},U=()=>{let e=new Date().getTime();return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let t=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(n=="x"?t:t&3|8).toString(16)})},D=({color:e,health:n,canShoot:t,size:i,hearts:s,speed:o,damage:a,position:l,bulletSpeed:H,type:O,logic:b=null,cooldown:p})=>{const A=U();let f=null;const E=()=>f===null||+new Date>f?(f=+new Date+p*1e3,console.log("cooldownEnds",f),!0):!1,L={color:e,health:n,canShoot:t,size:i,hearts:s,speed:o,damage:a,position:l,type:O,uuid:A,cooldown:p,score:0,fullHealth:n,draw:function(){g({color:e,size:i,position:l}),N({color:"black",size:i,width:2,position:l,value:this.health/this.fullHealth})},animate:function(){b&&b(this,h),l.x+=this.speed.x,l.y+=this.speed.y},shoot:function(u){if(E()){const C=c(u).sub(l).setLength(H);h.bullets.push(q({color:e,damage:a,size:3,speed:C,owner:this,position:{x:l.x,y:l.y}}))}},hit:function(u){return!t&&E()?u.getDamage(a):!1},getDamage:function(u){if(this.health-=u,this.health<=0)if(this.hearts>1)this.hearts--,this.health=this.fullHealth;else return this.disabled=!0,!0;return!1}};return h.players.push(L),L},X=(e,n)=>{let t=null,i=-1;if(n.players.forEach(s=>{if(s.type!==e.type){const o=c(s.position).distanceTo(e.position);(!t||o<i)&&(t=s,i=o)}}),t!==null){const s=e.speed.common;if(!e.canShoot)i>e.size?e.speed=m({common:s},c(t.position).sub(e.position).setLength(s)):e.speed.x=e.speed.y=0;else{let o=c(t.position).sub(e.position).setLength(s*.01);(i>20*e.size||i<5*e.size)&&(o=c(t.position).sub(e.position).setLength(s),i<5*e.size&&(o=o.mul(-1))),o=o.add(o.perpendicular().setLength(s)).setLength(s),e.speed=m({common:s},o),e.shoot(t.position)}}},Y=()=>{const e=D({color:x.player,health:30,canShoot:!0,size:10,type:"player",hearts:3,speed:{x:0,y:0,common:5},damage:1,position:{x:d.w/2,y:d.h/2},bulletSpeed:10,cooldown:.1});return B(e),e},_=e=>(e||(e={health:10,canShoot:Math.random()>.5,size:10,speed:{x:0,y:0,common:.3},damage:1,bulletSpeed:10,cooldown:1}),D(m({color:e.canShoot?x.shootingEnemy:x.enemy,type:"enemy",hearts:1,position:{x:Math.random()*d.w,y:Math.random()*d.h},logic:X},e))),j=e=>{const n=Math.random()<.7;let t,i,s;return s=.3+2.7*Math.random(),n?(t=.05+1.95*Math.random(),i=1+Math.min(e*.2*t,25)):(t=1+3*Math.random(),i=1+Math.min(e*.1*t/s,25)),_({health:10+.2*e,size:10+Math.min(20,e*2),bulletSpeed:10,speed:{x:0,y:0,common:s},canShoot:n,damage:i,cooldown:t})},K=e=>{const n=Math.random()<.5?1:1+Math.random()*e,t=[];for(let s=0;s<n;++s)t.push(Math.random());const i=t.reduce((s,o)=>s+o,0);t.forEach(s=>{const o=s/i,a=1+o*(e-1);j(a)})},G=(e,n)=>{k({color:"black",width:e.fullHealth*3,height:20,position:{x:10,y:10}}),k({color:"green",width:e.health*3,height:20,position:{x:10,y:10}}),R({text:`score: ${e.score}  level: ${n}`,color:"black",size:30,position:{x:10,y:90}});for(let t=0;t<e.hearts;t++)g({color:"red",size:10,position:{x:20+t*30,y:50}})};let y=1;const P=()=>{h.animate(),h.draw(),h.players.length&&G(h.players[0],y),h.isLevelFinished()&&(y++,K(y)),window.requestAnimationFrame(P)},J=()=>{Y(),K(y),P()};J();
